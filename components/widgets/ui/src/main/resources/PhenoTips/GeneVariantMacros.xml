<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see http://www.gnu.org/licenses/
-->

<xwikidoc version="1.1">
  <web>PhenoTips</web>
  <name>GeneVariantMacros</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1438730976000</creationDate>
  <parent>PhenoTips.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1439237364000</date>
  <contentUpdateDate>1439230895000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content>{{include reference="PhenoTips.TabelarDataMacros" /}}&#xd;
&#xd;
{{velocity output=false}}&#xd;
## =====================================================================&#xd;
##&#xd;
## Genes and variants entered in the patient report&#xd;
##&#xd;
##&#xd;
#macro (__variant_editTool $variantIndex)&#xd;
  {{html clean="false"}}&lt;a class="action edit variant-edit button secondary" href="#" id="PhenoTips.GeneVariantClass_${variantIndex}_edit" title="$services.localization.render('phenotips.geneVariantMacros.edit.hint')">$services.localization.render('phenotips.geneVariantMacros.edit')&lt;/a>{{/html}}##&#xd;
#end&#xd;
#macro (__variant_editDoneTool $variantIndex)&#xd;
  {{html clean="false"}}&lt;a class="action edit button secondary variant-edit-done" style="display: none;"  href="#" id="PhenoTips.GeneVariantClass_${variantIndex}_editDone"  title="$services.localization.render('phenotips.geneVariantMacros.editDone.hint')">$services.localization.render('phenotips.geneVariantMacros.editDone')&lt;/a>{{/html}}##&#xd;
#end&#xd;
#macro (__variant_hideTableTool $geneNumber)&#xd;
  {{html clean="false"}}&lt;a class="action edit button secondary variant-hide-show" style="float: right;"  href="#" id="PhenoTips.GeneVariantClass_${geneNumber}_hide"  title="$services.localization.render('phenotips.geneVariantMacros.hide.hint')">Hide variants&lt;/a>{{/html}}##&#xd;
#end&#xd;
##&#xd;
##&#xd;
##&#xd;
#macro (__variant_row $variantObj $count $variantIndex $options)&#xd;
|(% class="pseudoindent" %) |(% class="variant" %) $count #foreach($propName in $options.defaultProperties) |(% class="variant variant-default-input variant-$variantIndex" %) $doc.display($propName, $options.mode, $variantObj) #end |(% class="variant moreinfo" %)(((#if ($options.mode == 'edit')(% class="variant-moreinfo-button-row" %)((((% class="buttonwrapper variant-moreinfo-button" %) #__variant_editTool($variantIndex))))#end&#xd;
#foreach ($prop in $variantObj.xWikiClass.properties)&#xd;
&#xd;
#set ($isDefault = $options.defaultProperties.contains($prop.getName()))&#xd;
#set ($isInputString = $options.inputStrings.contains($prop.getName()))&#xd;
#set($rawValue = $variantObj.getProperty($prop.getName()).value)&#xd;
#if ($prop.getName() != 'genesymbol')|(% class="variant-moreinfo variant-property-name-$variantIndex #if ($rawValue == 'NA' || $rawValue == '')variant-edit-done#end" %)**${prop.translatedPrettyName}**|#if($isDefault)(% class="default-$variantIndex" %)#{end} (% class="variant-property-value ${prop.getName()}-$variantIndex #if ($options.mode == 'edit' &amp;&amp; !$isDefault)variant-label-$variantIndex #end #if ($rawValue == 'NA' || $rawValue == '')variant-edit-done#end"%)#if($isInputString) $rawValue#else$doc.display($prop.getName(), 'view', $variantObj )#end(%%) #if ($options.mode == 'edit' &amp;&amp; !$isDefault)(% class="variant-edit-done variant-input-$variantIndex" %)$doc.display($prop.getName(), $options.mode, $variantObj )#end#end##&#xd;
#end&#xd;
))) #if ($options.mode == 'edit')(% class="buttonwrapper variant-moreinfo-button" %)#__variant_editDoneTool($variantIndex)|(% class="variant" %)#__extradata_deleteTool($variantObj.xWikiClass.name '')#end\\&#xd;
#end&#xd;
##&#xd;
##&#xd;
##&#xd;
#macro(__variant_head $count $geneNumber $geneName $options)##&#xd;
|(%class="pseudoindent"%) |=(% colSpan="6" class="variant variant-title" %) $services.localization.render('phenotips.geneVariantMacros.variantTable.title', [$geneName, $count]) (% class="buttonwrapper" %)#__variant_hideTableTool($geneNumber)|(% class="pseudoindent" %) \\&#xd;
(%class="variant-hide-heading-$geneNumber"%)|(%class="pseudoindent"%) |=(% class="variant" %)(%%)#foreach($propName in $options.defaultProperties) |=(% class="variant col-label" %) $propName #end |=(% class="variant" %)$services.localization.render('phenotips.geneVariantMacros.variantTable.moreInfo') |=(% class="variant" %)&#xd;
#end&#xd;
##&#xd;
##&#xd;
##&#xd;
#macro(__variant_foot $options)##&#xd;
|(%class="pseudoindent"%) |(% colSpan="6" class="variant-footer" %) #if ($options.mode == 'edit')#__extradata_addTool('PhenoTips.GeneVariantClass' '' $options)#end\\&#xd;
#end&#xd;
##&#xd;
##&#xd;
##&#xd;
#macro(__variant_table $variantObjects $geneNumber $geneName $options)##&#xd;
#if ($variantObjects.size() > 0)##&#xd;
#__variant_head($variantObjects.size(), $geneNumber, $geneName, $options)&#xd;
#foreach ($o in $variantObjects)&#xd;
#set ($variantIndex = $foreach.index + $geneNumber)&#xd;
#set ($variantCount = $foreach.count)&#xd;
(%class="variant-hide-heading-$geneNumber"%)#__variant_row($o "${geneNumber}.${variantCount}" $variantIndex $options)&#xd;
#end&#xd;
#end&#xd;
#__variant_foot($options)&#xd;
#end&#xd;
##&#xd;
##&#xd;
##&#xd;
#macro (__gene_row $geneObj $geneNumber $variantClass $options)&#xd;
#set($variantObjects = $doc.getObjects($variantClass.name, "genesymbol", $geneObj.getProperty('gene').value))&#xd;
|$geneNumber #foreach($prop in $geneObj.xWikiClass.properties) |(% class="gene col-label" #if ($foreach.index == 0) colspan="2" #end %) $doc.display($prop.name, $options.mode, $geneObj) #end|#if ($options.mode == 'edit')(% class="gene" %)#__extradata_deleteTool($geneObj.xWikiClass.name '')#end&#xd;
&#xd;
#set ($discard = $options.put(propertyValue, $geneObj.getProperty('gene').value))##&#xd;
#__variant_table($variantObjects $geneNumber $geneObj.getProperty('gene').value $options)&#xd;
#end&#xd;
##&#xd;
##&#xd;
##&#xd;
#macro (__gene_table $options)&#xd;
#set($geneClass = $xwiki.getDocument('PhenoTips.GeneClass').xWikiClass)&#xd;
#set($variantClass = $xwiki.getDocument('PhenoTips.GeneVariantClass').xWikiClass)&#xd;
=== $services.localization.render('phenotips.UIXField.genes.sheetTitle')===&#xd;
(% id="gene-table" class="gene-table extradata-list" %)&#xd;
|= #foreach($prop in $geneClass.properties) |=(% class="gene"  #if ($foreach.index == 0) colspan="2" #end %) $prop.translatedPrettyName #end |=(% class="gene" %)&#xd;
#set($geneObjects = $doc.getObjects($geneClass.name))&#xd;
#foreach ($o in $geneObjects)&#xd;
#set ($geneNumber = $foreach.count)&#xd;
#__gene_row($o $geneNumber $variantClass $options)&#xd;
#end&#xd;
|(% colSpan="8" class="gene" %) #if ($options.mode == 'edit')#__extradata_addTool('PhenoTips.GeneClass' '' {'newEntryLabel' : $services.localization.render('phenotips.geneVariantMacros.geneTable.newEntry')})#end&#xd;
#end&#xd;
{{/velocity}}</content>
</xwikidoc>
